#!/usr/bin/env bash
set -e

# Ensure 1Password CLI is available
if ! command -v op >/dev/null 2>&1; then
  echo "⚠️  1Password CLI (op) not found; skipping SSH key setup"
  exit 0
fi

item_title="$(hostname) SSH Key"

# 1) If the SSH_KEY item doesn’t exist yet, create it (this will generate an ed25519 pair)
if ! op item get "$item_title" >/dev/null 2>&1; then
  echo "🔐 Generating new SSH key in 1Password: $item_title"
  op item create \
    --title "$item_title" \
    --category SSH_KEY
fi
