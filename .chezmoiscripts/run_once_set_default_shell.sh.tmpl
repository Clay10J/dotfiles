{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env sh
set -eu

# Only proceed if zsh is installed
if ! command -v zsh >/dev/null 2>&1; then
  exit 0
fi

# Determine current and desired shells
USER_NAME=$(whoami)
DESIRED_SHELL=$(command -v zsh)
CURRENT_SHELL=$(getent passwd "$USER_NAME" | cut -d: -f7)

# If they differ, change the login shell to zsh
if [ "$CURRENT_SHELL" != "$DESIRED_SHELL" ]; then
  printf 'Changing default shell to %s for user %s\n' "$DESIRED_SHELL" "$USER_NAME"
  # Use sudo if available (youâ€™ll be prompted for your password)
  if command -v sudo >/dev/null 2>&1; then
    sudo chsh -s "$DESIRED_SHELL" "$USER_NAME"
  else
    chsh -s "$DESIRED_SHELL" "$USER_NAME"
  fi
fi
{{- end -}}
