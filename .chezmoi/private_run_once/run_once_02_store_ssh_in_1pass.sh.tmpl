#!/usr/bin/env bash
set -e
TITLE="SSH key $(hostname)"
# skip if already stored
if op item list --categories SSH_KEY --vault Personal \
     | grep -qxF "$TITLE"; then
  exit 0
fi
# sign in if needed
if ! op whoami &>/dev/null; then
  eval "$(op signin)"
fi
KEY_PRIV="$HOME/.ssh/id_ed25519"
KEY_PUB="$HOME/.ssh/id_ed25519.pub"
# create with assignment args (no --fields)
op item create \
  --category SSH_KEY \
  --title "$TITLE" \
  --vault Personal \
  privateKey="$(<"$KEY_PRIV")" \
  publicKey="$(<"$KEY_PUB")"
echo "ðŸ” Stored SSH key in 1Password as '$TITLE'"
